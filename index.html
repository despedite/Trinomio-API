  <!DOCTYPE html>
  <html>
    <head>
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

      <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>

    <body>

      <nav>
        <div class="nav-wrapper">
          <a href="index.html" class="brand-logo">APIHook</a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="index.html">Personas</a></li>
          </ul>
        </div>
      </nav>

      
          <table id="records_table" border='1' class="responsive-table">
          </table>

          <div class="fixed-action-btn">
  <a class="btn-floating btn-large red" href="./crear.html">
    <i class="large material-icons waves-effect waves-light">add</i>
  </a>
</div>

      <script type="text/javascript">
   	   function showTable() {
	      $.getJSON('http://evera.challenge.trinom.io/api/peoples', function(data) {

	          var keys = Object.keys(data.data);

	          //Reset the data, in case this is executed more than once (E.G. when deleting an user)
	          document.getElementById('records_table').innerHTML = '<thead><tr><th>#</th><th>Nombre</th><th>Apellido</th><th>Email</th><th>Cursos</th><th>Acciones</th></tr></thead><tbody>';

	          for(var i=0; i<keys.length; i++){

	            $('<tr class="parent" id="' + data.data[i].id + '">').append(
	              $('<td>').text(data.data[i].id),
	              $('<td>').text(data.data[i].first_name),
	              $('<td>').text(data.data[i].last_name),
	              $('<td>').text(data.data[i].email),
	              $('<td><span class="expand btn-floating waves-effect waves-teal btn-flat"><i class="material-icons left icon-black">fullscreen</i></span>'),
	              $('<td><a href="./modificar.html"><span class="btn-floating waves-effect waves-teal btn-flat"><i class="material-icons left icon-black">edit</i></span></a> <a onclick="eliminarEntrada(' + "'" + data.data[i].first_name + "'" + ', ' + data.data[i].id + ');"><span class="btn-floating waves-effect waves-teal btn-flat"><i class="material-icons left icon-black">delete</i></span></a>')
	            ).appendTo('#records_table');

	            var keystwo = Object.keys(data.data[i].courses);
	            for(var j=0; j<keystwo.length; j++){
	              $('<tr class="child-' + data.data[i].id + '">').append(
	                $('<td style="background-color:lightgrey">').text(data.data[i].courses[j].id),
	                $('<td colspan="5" style="background-color:lightgrey"> <b>' + data.data[i].courses[j].name + '</b><br>' + data.data[i].courses[j].level.name + '<br><small>' + data.data[i].courses[j].language.name + "</small><br> ...") //TODO: removes last line??
	              ).appendTo('#records_table');
	            }
	          }
	          // TO-DO: Close all on page done loading and NOT on table done loading
	          cerrarTodo();
	      });
   	   }

      function eliminarEntrada(strg, id) {
      	var url = "http://evera.challenge.trinom.io/api/peoples/" + id;
	    $.ajax({
	      url: url,
	      type: "DELETE",
	      data: JSON.stringify({"people": id}),
	      contentType: "application/json",
	      dataType: 'json',
	      error: function(xhr, status, error) {
	        console.log(error);
	        console.log(xhr.responseText);
	        M.toast({html: 'Hay un error en tu solicitud.', classes: 'rounded'});
	      },
	      success: function() {
	        M.toast({html: '¡El usuario "' + strg + '" fue eliminado con éxito!', classes: 'rounded'});
	        showTable();
	      } //TO-DO: send them back to index. probably add an alert afterwards
	    });
      }

      function cerrarTodo() {
      	$('tr[class^=child-]').hide().children('td');
      }

      	$(document).ready ( function () {
		  $(document).on("click",'tr.parent td span.expand',function(){
		    var idOfParent = $(this).parents('tr').attr('id');
		    $('tr.child-'+idOfParent).toggle('fast');
		  });
		});

      //show table when web page opens
      showTable();
      </script>

      <style type="text/css">
		i.icon-black {
		    color: black;
		}
      </style>

      <!--JavaScript at end of body for optimized loading-->
      <script type="text/javascript" src="js/materialize.min.js"></script>
      
    </body>
  </html>