<!DOCTYPE html>
<html>
<head>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><!--Import materialize.css-->
  <link href="css/materialize.min.css" media="screen,projection" rel="stylesheet" type="text/css">
  <script src="js/jquery-3.4.1.min.js" type="text/javascript">
  </script><!--Let browser know website is optimized for mobile-->
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title></title>
</head>
<body>
  <nav>
    <div class="nav-wrapper">
      <a class="brand-logo" href="#">APIHook</a>
      <ul class="right hide-on-med-and-down" id="nav-mobile">
        <li>
          <a href="collapsible.html">Personas</a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="container">
    <div class="row">
      <form action="./script.php" id="dropdown" method="get" name="dropdown">
        <label for="first_name">First Name</label> <input id="text" name="first_name"> <label for="last_name">Last Name</label> <input id="surname" name="last_name"> <label for="email">Email</label> <input id="email" name="email">
      </form>
      <div id="demo">
        <script type="text/javascript">
          var urlParams = new URLSearchParams(window.location.search);
let dropdown = $('#dropdown');
$.getJSON('http://evera.challenge.trinom.io/api/courses', function(data) {
  var ele = document.getElementById('dropdown');
  for (var i = 0; i < data.length; i++) {
    ele.innerHTML += '<p><label><input type="checkbox" name="' + data[i].id + '" id="' + data[i].id + '" value="yes"/><span>' + data[i].name + '</span></label></p>'
  }
  ele.innerHTML += '<a onclick="enviarAJson();">Nice</a>'
});

function enviarAJson() {
  var first_name = document.getElementById("text").value;
  var last_name = document.getElementById("surname").value;
  var email = document.getElementById("email").value;
  var selected_courses = [];
  var amountOfObjects;
  // Might be a very round-about way to check how many checkboxes are there, but it makes sense to me, so I ain't complaining.
  // TO-DO: check if I can make this in a less round-about way
  $.getJSON('http://evera.challenge.trinom.io/api/courses', function(data) {
    amountOfObjects = data.length;
    for (var i = 0; i < amountOfObjects; i++) {
      selected_courses[i] = document.getElementById(data[i].id).checked;
    }
  });
  var dateObj = new Date();
  var curTime = dateObj.toISOString();
  var jsonObj = {
    'id': 0,
    'first_name': first_name,
    'last_name': last_name,
    'email': email,
    'created_at': curTime,
    'updated_at': curTime,
    'courses': []
  }
  //template for the JSON we're going to add the courses to!
  $.getJSON('http://evera.challenge.trinom.io/api/courses', function(data) {
    for (var i = 0; i < data.length; i++) {
      if (selected_courses[i] == true) {
        jsonObj.courses.push({
          'id': (i + 1),
          'name': 'placeholder',
          'language_code': 'ph',
          'level_id': 0,
          'created_at': curTime,
          'updated_at': curTime,
          'level': {
            'id': 0,
            'name': 'placeholder'
          },
          'language': {
            'code': 'placeholder',
            'name': 'placeholder'
          }
        })
        //luckily Trinomio did all of the heavy lifting, and by just inputting the ID number it fills all of the spaces for us.
      }
    }
    //Finally, FINALLY, we have our JSON object. Finally.
    //Now we can just send a POST request to the API server.
    //I got stuck for like a day on this part because JS variables were messing with me.
    console.log(JSON.stringify(jsonObj))
    if (urlParams.has('edit')) { //urlparams edit = true
      var peoplesId = urlParams.get('id');
      var url = "http://evera.challenge.trinom.io/api/peoples/" + peoplesId;
      console.log(url);
      var peoplesType = "PUT";
      var peoplesTerm = "actualizado";
    } else {
      var url = "http://evera.challenge.trinom.io/api/peoples";
      var peoplesType = "POST";
      var peoplesTerm = "subido";
    }
    $.ajax({
      url: url,
      type: peoplesType,
      data: JSON.stringify(jsonObj),
      contentType: "application/json",
      dataType: 'json',
      error: function(xhr, status, error) {
        console.log(error);
        console.log(xhr.responseText);
        M.toast({html: '¡Hay un error en tus respuestas!', classes: 'rounded'});
      },
      success: function() {
        M.toast({html: '¡Tu entrada se ha ' + peoplesTerm + ' con éxito!', classes: 'rounded'});
      } //TO-DO: send them back to index. probably add an alert afterwards
    });
  });
}
<<<<<<< HEAD


function loadData() {
if(urlParams.has('edit')) {
  var first = document.getElementById('text');
  var last = document.getElementById('surname');
  var email = document.getElementById('email');

  first.value = urlParams.get('first_name')
  last.value = urlParams.get('last_name')
  email.value = urlParams.get('email')
  }
}

//NOTE: The following could be on the function loadData();, but since we have to wait until the JSON-populated
//checkboxes load before changing the title, it looks jarring and breaks the illusion of two different forms.
if(urlParams.has('edit')) {
  var ele = document.getElementById('title');
  ele.innerHTML = "Modificar una persona"
}
        </script>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="js/materialize.min.js"></script>
</body>
</html>